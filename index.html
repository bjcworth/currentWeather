
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Current Weather</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<link rel="stylesheet" href="./css/flag-icon.css">
	<!--<link rel="stylesheet" href="./assets/docs.css">-->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<style>
body {
	background-color: #b0c4de;
}
::-webkit-input-placeholder {
   text-align: center;
}

:-moz-placeholder { /* Firefox 18- */
   text-align: center;  
}

::-moz-placeholder {  /* Firefox 19+ */
   text-align: center;  
}

:-ms-input-placeholder {  
   text-align: center; 
}
.container {
	position: absolute;
	top:0;
	width: 100%;
	text-align: center;
}
.child {
	position: relative;
}
.container, #locSearch {
	margin-left: auto;
    margin-right: auto;
	padding: 10px;
    border: 5px;
    margin-top: 20px;
    margin-bottom: 20px;
    display: none;
}

#demo {
	text-transform: capitalize;
	position: relative;
}
#spinner {
	display: none;
}
.result {
	text-align: center;
	margin-left: auto;
	margin-right: auto;
	position: relative;
}

</style>

</head>

<body>
	<div class="container">
		<h1>Enter location for current weather 
			<span class="glyphicon glyphicon-cloud"></span>
		</h1>   
		<div class="child">
			<form class="form-inline" id="locSearch" role="form" action="javascript:console.log('Form initialized!');">
				<div class="form-group" data-toggle="tooltip" data-placement="left" title="Any city, state, country, continent or zip">
					<span class="glyphicon glyphicon-globe" style="font-size:150%"></span>
					<label for="inputdefault" style="font-size:150%">Location:</label>
					
					<input type="text" class="form-control" placeholder="(i.e. Boston, MA or 02215)" autofocus>
				</div>
				<button type="submit" class="btn btn-primary btn-md"><span class="glyphicon glyphicon-search"></span> Search
				</button>
			</form>
		</div>
		<div class="result">

			
			<h3 id="res">
				<span id="spinner">
					<i class="fa fa-spinner fa-2x fa-pulse"></i>
				</span>
				<span id="demo">
				</span>
			</h3>
		</div>
	</div>

	

	

<script>

	$(document).ready(function () {
	   $('.container').fadeIn(1500, function(){
	   		$('#locSearch').slideDown("slow");
	   });
	   
	  // $('[data-toggle="tooltip"]').tooltip();
	   });



	
	
	$('#locSearch').submit(function(event) {
		// bounce search on submit
		$('.child').effect( "bounce", {distance: 10, times: 3 }, "slow", function() {

		} );
		var div = document.getElementById('demo');
		$(div).empty();
		$(div).hide();
		if($(div).css('display')=='none') {
		 	$('#spinner').fadeIn(500);
		}
		var url = "http://api.openweathermap.org/data/2.5/weather?q=";
		var units = "&units=imperial&callback=locResults";
		var formdata = document.getElementById('locSearch');
		var loc = "";
		var i;
		for (i=0; i<formdata.length; formdata++) {
			loc += formdata.elements[i].value;
		}
		// reset the form now that we've saved the data from it
		$('#locSearch')[0].reset();
		// trim form entry of any extra whitespace
		loc = loc.trim();
		url += loc + units;
		$.ajax({url: url,
				dataType: "jsonp",
			success: function(loc_parse){
				console.log("Succes!");
				if (loc_parse['message']){
					$('#spinner').hide();
					var msg = loc_parse['message'];
					alert(msg);
					$('#locSearch')[0].reset();
				}
				else {

					var iconURL = "http://openweathermap.org/img/w/";
					var icon = loc_parse['weather'][0]['icon'];
					var city = loc_parse['name'];
					var country = loc_parse['sys']['country'];
					var temp = Math.round(loc_parse['main']['temp']);
					if (country=="United States of America") {
						country="US";
					}
					iconURL += icon +".png";
					var location;
					// city search
					if(city) {
						location = city + ", " + country;
					}
					// continent search
					else if(!country) { location = loc;}
					// country search
					else if ((loc == country)||(country.indexOf("Islands")>=0)) { location = country;}
					// state/province search
					else if ((loc != country) && !city) { 
						// if string contains country, just use the string
						// bc we know the format is province, country
						if ((loc.indexOf(country)>=0) ||(loc.indexOf(country.toLowerCase())>=0)) {
							// full capitalization of country
							if(loc.indexOf(country.toLowerCase())>=0) {
								loc = loc.replace(country.toLowerCase(), country);
							}
							location = loc;
						}
						// otherwise, only a state/province was entered
						else {
							location = loc + ", " + country;
						}
					}
					var code;
					var flagIcon;
					var flagURL;
					// flag stuff
					if (country.length==2) {
						code = country.toLowerCase();
						flagIcon = "\"flag-icon flag-icon-" + code + '"';
						flagURL = '<span id=\"flag\"class='+flagIcon+'></span> ';
						$(div).prepend(flagURL);
					}
					else {
						$.ajax({
							url: "http://data.okfn.org/data/core/country-list/r/data.json",
							dataType: "json",
							success: function(country_parse){
								//alert('old cntry: '+country);
								if(country.indexOf('And')>=0){
									country = country.replace("And","and");
								}
								for(var i=0; i<country_parse.length; i++){
									if(country_parse[i]['Name'].indexOf(country)>=0) {
										//alert(country);
										code = country_parse[i]['Code'].toLowerCase();
										flagIcon = "\"flag-icon flag-icon-" + code + '"';
										flagURL = '<span id=\"flag\"class='+flagIcon+'></span> '
										$(div).prepend(flagURL);
										break;
										
									}
								}
							}

						});
					}
		 			// hide loading spinner, don't do anything til this is document
		 			$('#spinner').hide("fast", function () {
			 				// add location to result
						$(div).append(location + ": ");
						// attach temp
						$(div).append(temp + "Â°");
						// attatch image
						$(div).append($('<img>',{id:'locIcon',src:iconURL,width:'50px',height:'50px'}));
						// fade in weather result after loading weather icon
						$('#locIcon').load(function() { $(div).fadeIn(500);});

		 			});

		 			
					
					
					
				}
			}
		});
		
		
	});
</script>
</body>
</html>
